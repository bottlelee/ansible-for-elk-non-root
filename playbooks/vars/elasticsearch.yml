---
elasticsearch_bootstrap_host: >-
  {{
    hostvars
      [
        groups['es_master'][0]
      ]
      [
        'ansible_host'
      ]
  }}

elasticsearch_node_roles:
  es_master:
    - master
    - data
    - remote_cluster_client
  es_hot:
    - data_content
    - data_hot
  es_warm:
    - data_content
    - data_warm
    - ingest
  es_cold:
    - data_content
    - data_cold
    - ingest
    - ml
    - transform

elasticsearch_http_port: 9200
elasticsearch_transport_port: 9300

# Note: The xpack_security.* are auto generated by the elasticsearch itself, DO NOT set them manually.
elasticsearch_config:
  cluster.name: "{{ elk_cluster_name }}"
  node.name: "{{ inventory_hostname }}.{{ elk_domain }}"
  network.host: "{{ elasticsearch_network_host | default('0.0.0.0') }}"
  http.host: "{{ elasticsearch_http_host | default(ansible_host) }}"
  http.port: "{{ elasticsearch_http_port }}"
  transport.host: "{{ elasticsearch_transport_host | default(ansible_host) }}"
  transport.port: "{{ elasticsearch_transport_port }}"
  bootstrap.memory_lock: true
  path.data: "{{ elk_data_dir }}/elasticsearch"
  path.logs: "{{ elk_logs_dir }}/elasticsearch"
  s3.client.default.endpoint: "http://{{ groups['minio'] | first }}.{{ elk_domain }}"
  node.roles: |
    {% for role in
      (elasticsearch_node_roles | dict2items)
        if role.key in group_names
    %}
    {{ role.value }}
    {% endfor %}

elasticsearch_after_bootstrap_config:
  xpack.security.http.ssl.client_authentication: "none"
  discovery.seed_hosts: "{{ elasticsearch_discovery_seed_hosts }}"

# Keystore settings
elasticsearch_keystore:
  xpack.security.http.ssl.keystore.secure_password: "{{ elasticsearch_cert_password }}"
  xpack.security.transport.ssl.keystore.secure_password: "{{ elasticsearch_cert_password }}"
  xpack.security.transport.ssl.truststore.secure_password: "{{ elasticsearch_cert_password }}"

# Elasticsearch discovery settings
elasticsearch_discovery_seed_hosts: >-
  [
    {%- for host in groups['es_master'] -%}
    "{{ host }}.{{ elk_domain }}:{{ elasticsearch_transport_port }}"{{ "," if not loop.last else "" }}
    {%- endfor -%}
  ]

elasticsearch_gateway_http_port: "{{ nginx_sites | selectattr('name', 'eq', 'elasticsearch') | map(attribute='listen_port') | first }}"
elasticsearch_gateway_url: "https://elasticsearch.{{ elk_domain }}:{{ elasticsearch_gateway_http_port }}"

elasticsearch_bin_dir: "{{ elk_install_dir }}/elasticsearch/bin"
