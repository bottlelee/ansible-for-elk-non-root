---
elasticsearch_bootstrap_host: >-
  {{
    hostvars
      [
        groups['es_master'][0]
      ]
      [
        'ansible_host'
      ]
  }}

elasticsearch_node_roles:
  es_master:
    - master
    - data
  es_hot:
    - data_content
    - data_hot
  es_warm:
    - data_content
    - data_warm
    - ingest
  es_ml:
    - ml
    - transform
    - data_cold
    - data_content
    - remote_cluster_client

elasticsearch_http_port: 9200
elasticsearch_transport_port: 9300

# Note: The xpack_security.* are auto generated by the elasticsearch itself, DO NOT set them manually.
elasticsearch_config:
  cluster.name: "{{ elk_cluster_name }}"
  node.name: "{{ inventory_hostname }}.{{ elk_domain }}"
  network.host: "{{ elasticsearch_network_host | default('0.0.0.0') }}"
  http.host: "{{ elasticsearch_http_host | default(ansible_host) }}"
  http.port: "{{ elasticsearch_http_port }}"
  transport.host: "{{ elasticsearch_transport_host | default(ansible_host) }}"
  transport.port: "{{ elasticsearch_transport_port }}"
  bootstrap.memory_lock: true
  path.data: "{{ elk_data_dir }}/elasticsearch"
  path.logs: "{{ elk_logs_dir }}/elasticsearch"
  node.roles: |
    {% for role in
      (elasticsearch_node_roles | dict2items)
        if role.key in group_names
    %}
    {{ role.value | sort }}
    {% endfor %}

# Keystore settings
elasticsearch_keystore:
  xpack.security.http.ssl.keystore.secure_password: "{{ elasticsearch_cert_password }}"
  xpack.security.transport.ssl.keystore.secure_password: "{{ elasticsearch_cert_password }}"
  xpack.security.transport.ssl.truststore.secure_password: "{{ elasticsearch_cert_password }}"

# Snapshot storage with MinIO
elasticsearch_minio_snapshot_bucket: "{{ minio_objects | selectattr('name', 'search', 'elasticsearch') | map(attribute='name') | first }}"
elasticsearch_minio_endpoint: "{{ groups['minio'] | map('extract', hostvars, ['ansible_host']) | first }}"
elasticsearch_minio_keystore:
  s3.client.default.access_key: "{{ lookup('file', inventory_dir + '/credentials/minio/' + elasticsearch_minio_snapshot_bucket + '_accessKey') }}"
  s3.client.default.secret_key: "{{ lookup('file', inventory_dir + '/credentials/minio/' + elasticsearch_minio_snapshot_bucket + '_secretKey') }}"
  # s3.client.default.session_token:

# Elasticsearch discovery settings
elasticsearch_discovery_seed_hosts: >-
  [
    {%- for host in groups['es_master'] -%}
    "{{ host }}.{{ elk_domain }}:{{ elasticsearch_transport_port }}"{{ "," if not loop.last else "" }}
    {%- endfor -%}
  ]

elasticsearch_gateway_http_port: "{{ nginx_sites | selectattr('name', 'eq', 'elasticsearch') | map(attribute='listen_port') | first }}"
elasticsearch_gateway_url: "https://elasticsearch.{{ elk_domain }}:{{ elasticsearch_gateway_http_port }}"

elasticsearch_bin_dir: "{{ elk_install_dir }}/elasticsearch/bin"